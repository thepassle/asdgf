const b=(s=Date.now())=>()=>(Date.now()-s).toFixed(2)+"ms";globalThis.QUEUE=[];function m(s){const t={tests:[],suiteOnly:!1,only:[],...s},o=(e,i)=>{t.tests.push({name:e,handler:i})};return o.only=(e,i)=>{t.only.push({name:e,handler:i})},o.skip=(e,i)=>{t.tests.push({name:e,handler:()=>({skipped:!0})})},{suite:t,it:o,before:e=>{t.before=e},beforeEach:e=>{t.beforeEach=e},after:e=>{t.after=e},afterEach:e=>{t.afterEach=e}}}function k(s,t,o={}){const{suite:n,it:r,before:l,beforeEach:u,after:e,afterEach:i}=m({name:s,...o});QUEUE.push(n),t({it:r,before:l,beforeEach:u,after:e,afterEach:i})}const w=(s,t)=>k(s,t);w.only=(s,t)=>k(s,t,{suiteOnly:!0}),w.skip=(s,t)=>k(s,t,{skip:!0});async function E(s="",t){try{await t?.()}catch(o){throw console.error(`Error in hook "${s}":`),new Error(o)}}async function g(s,{renderer:t}={}){const{name:o,only:n,tests:r,before:l,after:u,beforeEach:e,afterEach:i,skip:d}=s,f=n.length?n:r,a={name:o,skipped:0,failed:0,total:0,tests:[]};if(d)return t?.suiteStart?.({skip:d,name:o,only:n,tests:r}),a.skipped=f.length,a.tests=f.map(({name:p})=>({name:p,passed:!1,duration:"",error:!1,skipped:!0})),a.total=f.length,t?.suiteEnd?.(a),a;t?.suiteStart?.({skip:d,name:o,only:n,tests:r}),await E("before",l);for(const p of f){const c={name:p.name,passed:!0,skipped:!1,duration:"",error:!1},y=b();await E("beforeEach",e);try{const{skipped:h}=await p.handler()||{};c.duration=y(),c.skipped=!!h,c.passed=!h,c.skipped&&a.skipped++}catch(h){a.failed++,c.passed=!1,c.duration=y(),c.error={expected:h?.expects,...h,message:h.message,stack:h.stack}}finally{a.total++,t?.renderTest?.(c),a.tests.push(c)}await E("afterEach",i)}return await E("after",u),t?.suiteEnd?.(a),a}async function U({renderer:s}={}){const t=b(),o=[],n=[];let r=0,l=0,u=0;const e=QUEUE.filter(f=>f.suiteOnly),d=e.length>0?e:QUEUE;for(const f of d){const a=await g(f,{renderer:s});r+=a.total,l+=a.skipped,u+=a.failed,a.tests.forEach(({error:p})=>{p&&n.push(p)}),o.push(a)}return{status:"FINISHED",total:r,skipped:l,failed:u,errors:n,passed:u<1,duration:t(),results:o}}export{w as describe,U as executeTests};
